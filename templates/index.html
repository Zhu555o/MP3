<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>MP3 快捷上传</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <!-- 引入外部 JavaScript 文件，defer 确保在 DOM 解析完成后执行 -->
    <script src="{{ url_for('static', filename='main.js') }}" defer></script>
</head>
<body class="index-page">
<div class="container">
    <a href="{{ url_for('logout') }}" class="auth-link">登出</a>
    <h1>MP3 快捷上传</h1>

    {% if is_authenticated %}
    <form id="uploadForm" class="upload-form">
        <input type="file" id="fileInput" name="file" accept=".mp3" required multiple>
        <input type="text" id="customFilename" name="custom_filename" placeholder="自定义文件名前缀 (可选)">
        <label>
            <input type="radio" name="uploadType" value="sync" checked> 同步上传
        </label>
        <label>
            <input type="radio" name="uploadType" value="async"> 异步上传 (推荐)
        </label>
        <label>
            <input type="radio" name="uploadType" value="multi"> 多线程上传 (实验性)
        </label>
        <button type="submit">上传 MP3 文件</button>
        <div class="progress-container" id="progressContainer">
            <div id="progressBar">
                <div id="progressBarFill">0%</div>
            </div>
            <div id="uploadMessage"></div>
            <div id="uploadCount"></div>
        </div>
    </form>
    {% else %}
    <p>请先 <a href="{{ url_for('login') }}">登录</a> 以上传文件。</p>
    {% endif %}

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="搜索文件名或大小...">
        <!-- 移除了 onclick，改为通过 JS 绑定 -->
        <button id="searchButton">搜索</button>
    </div>

    <div class="file-list" id="fileList">
    </div>
    <div class="pagination" id="pagination">
    </div>

    <div class="audio-player-section">
        <h2>音频播放器</h2>
        <audio id="audioPlayer" controls>
            您的浏览器不支持音频元素。
        </audio>
    </div>
</div>
<!-- 将 Jinja2 变量传递给 JS，通过一个隐藏的 script 标签 -->
<script id="config-data" type="application/json">
    {
        "MAX_FILE_SIZE_MB": {{ config.get('UPLOAD_SETTINGS', {}).get('MAX_FILE_SIZE_MB', 100) }},
        "GLOBAL_CSRF_TOKEN": "{{ csrf_token }}"
    }
</script>
</body>
</html>